<!DOCTYPE html>
<html>
<head>
    <title>Employee Management (API)</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
</head>

<body class="bg-dark text-white">
<div class="container mt-5">
    <h2 class="text-center mb-4">Employee Management (API View)</h2>

    <!-- Add Employee Form -->
    <div class="card bg-secondary p-3 mb-4">
        <h5>Add Employee</h5>
        <div class="row g-2">
            <div class="col-md-3"><input id="name" class="form-control" placeholder="Name"></div>
            <div class="col-md-3"><input id="position" class="form-control" placeholder="Position"></div>
            <div class="col-md-3"><input id="salary" class="form-control" placeholder="Salary" type="number"></div>
            <div class="col-md-3">
                <input id="image" class="form-control" type="file">
            </div>
        </div>
        <button onclick="addEmployee()" class="btn btn-success mt-3 w-100">Add Employee</button>
    </div>

    <!-- Employee List Table -->
    <table class="table table-bordered table-striped table-dark">
        <thead>
            <tr>
                <th>ID</th>
                <th>Name</th>
                <th>Position</th>
                <th>Salary</th>
                <th>Image</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody id="employeeTable"></tbody>
    </table>
</div>

<script>
const baseURL = '/apiapp/employees/';

// ✅ Load all employees
function loadEmployees() {
    fetch(baseURL)
        .then(res => res.json())
        .then(data => {
            const table = document.getElementById('employeeTable');
            table.innerHTML = '';
            data.forEach(emp => {
                table.innerHTML += `
                    <tr>
                        <td>${emp.id}</td>
                        <td>${emp.name}</td>
                        <td>${emp.position}</td>
                        <td>${emp.salary}</td>
                        <td>${emp.image ? `<img src="${emp.image}" width="60">` : 'No image'}</td>
                        <td>
                            <button class="btn btn-sm btn-warning" onclick="editEmployee(${emp.id})">Edit</button>
                            <button class="btn btn-sm btn-danger" onclick="deleteEmployee(${emp.id})">Delete</button>
                        </td>
                    </tr>
                `;
            });
        });
}

// ✅ Add Employee
function addEmployee() {
    const formData = new FormData();
    formData.append('name', document.getElementById('name').value);
    formData.append('position', document.getElementById('position').value);
    formData.append('salary', document.getElementById('salary').value);
    const imageFile = document.getElementById('image').files[0];
    if (imageFile) formData.append('image', imageFile);

    fetch(baseURL, {
        method: 'POST',
        body: formData
    })
    .then(res => res.json())
    .then(data => {
        alert('Employee added!');
        loadEmployees();
        document.getElementById('name').value = '';
        document.getElementById('position').value = '';
        document.getElementById('salary').value = '';
        document.getElementById('image').value = '';
    });
}

// ✅ Delete Employee
function deleteEmployee(id) {
    if (confirm('Are you sure you want to delete this employee?')) {
        fetch(baseURL + id + '/', { method: 'DELETE' })
        .then(res => {
            if (res.status === 204) {
                alert('Deleted successfully!');
                loadEmployees();
            } else {
                alert('Failed to delete');
            }
        });
    }
}

// ✅ Edit Employee (prompt-based simple edit)
function editEmployee(id) {
    const newName = prompt("Enter new name:");
    const newPosition = prompt("Enter new position:");
    const newSalary = prompt("Enter new salary:");

    const updatedData = { name: newName, position: newPosition, salary: newSalary };

    fetch(baseURL + id + '/', {
        method: 'PUT',
        headers: { 'Content-Type': 'application/json' },
        body: JSON.stringify(updatedData)
    })
    .then(res => res.json())
    .then(data => {
        alert('Updated successfully!');
        loadEmployees();
    });
}

// Load on page start
loadEmployees();
</script>

</body>
</html>
